<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ITパスポート 習得支援アシスタント</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        header { border-bottom: 2px solid #e2e8f0; margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .tag { font-size: 0.8rem; background: #e2e8f0; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .options { display: grid; gap: 10px; margin-top: 20px; }
        button.opt-btn { text-align: left; padding: 15px; border: 1px solid #cbd5e1; border-radius: 8px; background: white; cursor: pointer; font-size: 1rem; }
        button.opt-btn:hover:not(:disabled) { background: #f1f5f9; border-color: var(--primary); }
        #feedback { margin-top: 20px; padding: 20px; border-radius: 8px; display: none; }
        .correct { background: #dcfce7; border: 1px solid #22c55e; }
        .incorrect { background: #fee2e2; border: 1px solid #ef4444; }
        #next-btn { margin-top: 20px; background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
        .badge { display: inline-block; background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 9999px; font-size: 0.85rem; margin: 4px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <span id="category-tag" class="tag">読み込み中</span>
            <span id="q-id" style="margin-left:10px; color:#64748b;">ID</span>
        </div>
        <div>習得単語数: <span id="learned-count">0</span></div>
    </header>

    <div id="quiz-area">
        <div id="question-text" style="font-size: 1.2rem; font-weight: bold; margin: 20px 0;">データを読み込んでいます...</div>
        <div id="options-container" class="options"></div>
        
        <div id="feedback">
            <div id="result-msg" style="font-weight:bold;"></div>
            <div id="explanation" style="margin-top:10px;"></div>
            <button id="next-btn">次の問題へ</button>
        </div>
    </div>

    <div id="vocab-section" style="margin-top:40px; border-top: 2px solid #e2e8f0; padding-top:20px;">
        <h3>習得済みキーワード</h3>
        <div id="learned-keywords"></div>
    </div>
</div>

<script>
let quizData = [];
let currentIndex = 0;
let learnedKeywords = new Set();

// JSONの読み込み
async function loadData() {
    try {
        const response = await fetch('questions.json');
        if (!response.ok) throw new Error('Network response was not ok');
        quizData = await response.json();
        renderQuestion();
    } catch (error) {
        document.getElementById('question-text').innerText = "エラー: JSONファイルが見つからないか、読み込めません。サーバー環境で実行してください。";
        console.error('Error loading JSON:', error);
    }
}

function renderQuestion() {
    if (quizData.length === 0) return;
    const q = quizData[currentIndex];
    
    document.getElementById('category-tag').innerText = q.category;
    document.getElementById('q-id').innerText = q.id;
    document.getElementById('question-text').innerText = q.question;
    document.getElementById('feedback').style.display = 'none';

    const container = document.getElementById('options-container');
    container.innerHTML = '';

    q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'opt-btn';
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(idx);
        container.appendChild(btn);
    });
}

function checkAnswer(selectedIdx) {
    const q = quizData[currentIndex];
    const feedback = document.getElementById('feedback');
    const resultMsg = document.getElementById('result-msg');

    if (selectedIdx === q.answer) {
        resultMsg.innerText = "⭕ 正解！";
        feedback.className = 'correct';
        q.keywords.forEach(k => learnedKeywords.add(k));
        updateVocabUI();
    } else {
        resultMsg.innerText = "❌ 不正解...";
        feedback.className = 'incorrect';
    }

    document.getElementById('explanation').innerText = q.explanation;
    feedback.style.display = 'block';
    document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
}

function updateVocabUI() {
    const container = document.getElementById('learned-keywords');
    container.innerHTML = '';
    learnedKeywords.forEach(k => {
        const badge = document.createElement('span');
        badge.className = 'badge';
        badge.innerText = k;
        container.appendChild(badge);
    });
    document.getElementById('learned-count').innerText = learnedKeywords.size;
}

document.getElementById('next-btn').onclick = () => {
    currentIndex = (currentIndex + 1) % quizData.length;
    renderQuestion();
};

// アプリ始動
loadData();
</script>
</body>
</html>
