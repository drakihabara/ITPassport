<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆ</title>
    <style>
        :root { --main: #1a1a1a; --border: #333; --gray: #757575; --light: #f5f5f5; }
        body { font-family: sans-serif; margin: 0; background: #fff; color: var(--main); line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        
        header { border-bottom: 2px solid var(--main); margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: baseline; }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 0.1rem; cursor: pointer; }
        
        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 40px; }
        .menu-btn { padding: 20px; border: 1px solid var(--border); background: #fff; cursor: pointer; font-size: 1.1rem; text-align: left; }
        .menu-btn:hover { background: var(--light); }

        /* ã‚¯ã‚¤ã‚ºãƒ»å˜èªå¸³å…±é€š */
        .screen { display: none; }
        .active { display: block; }
        
        .meta { color: var(--gray); font-size: 0.85rem; margin-bottom: 10px; }
        .q-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 30px; }
        .options { display: flex; flex-direction: column; gap: 10px; }
        .opt-btn { text-align: left; padding: 18px; border: 1px solid var(--border); background: #fff; cursor: pointer; font-size: 1rem; }
        .opt-btn:hover:not(:disabled) { background: var(--light); }

        /* è§£èª¬ãƒ»çµæœ */
        #feedback { margin-top: 30px; padding: 20px; border: 2px solid var(--main); display: none; }
        .action-btn { margin-top: 20px; width: 100%; padding: 15px; background: var(--main); color: #fff; border: none; cursor: pointer; font-size: 1rem; }

        /* å˜èªå¸³ãƒ¢ãƒ¼ãƒ‰ */
        .term-item { border-bottom: 1px solid var(--border); padding: 15px 0; }
        .term-name { font-weight: bold; font-size: 1.1rem; }
        .term-def { font-size: 0.9rem; color: #444; margin-top: 5px; }

        /* ã€Œã¾ã ã€ãƒœã‚¿ãƒ³ */
        .still-btn { margin-top: 40px; width: 100%; padding: 12px; background: none; border: 1px solid var(--gray); color: var(--gray); cursor: pointer; }

        /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼ˆå³ä¸‹ï¼‰ */
        .footer-tools { position: fixed; right: 20px; bottom: 40px; z-index: 100; }
        .reset-link { font-size: 0.75rem; color: #999; border: none; background: none; text-decoration: underline; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 onclick="showScreen('home')">ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆ</h1>
        <div id="top-stats" style="font-size:0.9rem; font-weight:bold;">ç¿’å¾—: <span id="master-count">0</span></div>
    </header>

    <div id="home" class="screen active">
        <div class="menu-grid">
            <button class="menu-btn" onclick="startQuiz('ã‚¹ãƒˆãƒ©ãƒ†ã‚¸')">1. ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»ã‚’è§£ã</button>
            <button class="menu-btn" onclick="startQuiz('ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ')">2. ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»ã‚’è§£ã</button>
            <button class="menu-btn" onclick="startQuiz('ãƒ†ã‚¯ãƒãƒ­ã‚¸')">3. ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»ã‚’è§£ã</button>
            <button class="menu-btn" onclick="startQuiz('ALL')">4. å…¨åˆ†é‡ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ </button>
            <button class="menu-btn" style="border-style: dashed;" onclick="showVocab()">ğŸ“š å˜èªå¸³ãƒ¢ãƒ¼ãƒ‰ï¼ˆç¿’å¾—æ¸ˆã¿ã®ã¿ï¼‰</button>
        </div>
    </div>

    <div id="quiz" class="screen">
        <div class="meta"><span id="q-cat">-</span> | <span id="q-id">-</span></div>
        <div id="q-text" class="q-text">-</div>
        <div id="options" class="options"></div>
        <button class="still-btn" onclick="jointReset()">ã¾ã ï¼ˆè‡ªä¿¡ãªã—ï¼šé–¢é€£ç”¨èªã‚’ãƒªã‚»ãƒƒãƒˆï¼‰</button>
        
        <div id="feedback">
            <div id="res-msg" style="font-weight:bold; margin-bottom:10px;"></div>
            <div id="explanation"></div>
            <button class="action-btn" onclick="nextQuestion()">æ¬¡ã®å•é¡Œã¸</button>
        </div>
    </div>

    <div id="vocab" class="screen">
        <h3>ç¿’å¾—æ¸ˆã¿å˜èªå¸³</h3>
        <p class="meta">å•é¡Œã‚’æ­£è§£ã™ã‚‹ã¨ã“ã“ã«å®šç¾©ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚</p>
        <div id="vocab-list"></div>
        <button class="action-btn" onclick="showScreen('home')">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
    </div>
</div>

<div class="footer-tools">
    <button class="reset-link" onclick="fullReset()">å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–</button>
</div>

<script>
let allData = { questions: [], terms: {} };
let filteredQuestions = [];
let currentIndex = 0;
let mastered = new Set(JSON.parse(localStorage.getItem('itp_mastered')) || []);

// åˆæœŸåŒ–
async function init() {
    try {
        const res = await fetch('questions.json');
        allData = await res.json();
        updateStats();
    } catch (e) {
        alert("questions.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
    }
}

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// ã‚¯ã‚¤ã‚ºé–‹å§‹
function startQuiz(cat) {
    if (cat === 'ALL') {
        filteredQuestions = [...allData.questions].sort(() => Math.random() - 0.5);
    } else {
        filteredQuestions = allData.questions.filter(q => q.category === cat);
    }
    
    if (filteredQuestions.length === 0) return alert("å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“");
    currentIndex = 0;
    showScreen('quiz');
    renderQuestion();
}

function renderQuestion() {
    const q = filteredQuestions[currentIndex];
    document.getElementById('q-cat').innerText = q.category;
    document.getElementById('q-id').innerText = q.id;
    document.getElementById('q-text').innerText = q.question;
    document.getElementById('feedback').style.display = 'none';
    
    const container = document.getElementById('options');
    container.innerHTML = '';
    q.options.forEach((opt, i) => {
        const b = document.createElement('button');
        b.className = 'opt-btn';
        b.innerText = opt;
        b.onclick = () => check(i);
        container.appendChild(b);
    });
}

function check(idx) {
    const q = filteredQuestions[currentIndex];
    const isCorrect = (idx === q.answer);
    const msg = document.getElementById('res-msg');
    
    if (isCorrect) {
        msg.innerText = "â­• æ­£è§£";
        msg.style.color = "green";
        q.term_ids.forEach(tid => mastered.add(tid));
    } else {
        msg.innerText = "âŒ ä¸æ­£è§£ï¼ˆé–¢é€£ç”¨èªã‚’ãƒªã‚»ãƒƒãƒˆï¼‰";
        msg.style.color = "red";
        q.term_ids.forEach(tid => mastered.delete(tid));
    }
    
    finalizeAnswer(q);
}

function jointReset() {
    const q = filteredQuestions[currentIndex];
    q.term_ids.forEach(tid => mastered.delete(tid));
    document.getElementById('res-msg').innerText = "æœªç¿’å¾—ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ";
    document.getElementById('res-msg').style.color = "#757575";
    finalizeAnswer(q);
}

function finalizeAnswer(q) {
    document.getElementById('explanation').innerText = q.explanation;
    document.getElementById('feedback').style.display = 'block';
    document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
    save();
}

// å˜èªå¸³è¡¨ç¤º
function showVocab() {
    showScreen('vocab');
    const list = document.getElementById('vocab-list');
    list.innerHTML = '';
    
    if (mastered.size === 0) {
        list.innerHTML = '<p>ã¾ã ç¿’å¾—ã—ãŸå˜èªã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
        return;
    }

    mastered.forEach(tid => {
        const term = allData.terms[tid];
        const div = document.createElement('div');
        div.className = 'term-item';
        div.innerHTML = `<div class="term-name">${term.name}</div><div class="term-def">${term.def}</div>`;
        list.appendChild(div);
    });
}

function nextQuestion() {
    currentIndex = (currentIndex + 1) % filteredQuestions.length;
    renderQuestion();
}

function save() {
    localStorage.setItem('itp_mastered', JSON.stringify([...mastered]));
    updateStats();
}

function updateStats() {
    document.getElementById('master-count').innerText = mastered.size;
}

function fullReset() {
    if(confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')) {
        localStorage.clear();
        location.reload();
    }
}

init();
</script>
</body>
</html>
