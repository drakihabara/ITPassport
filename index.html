<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ITパスポート演習アプリ</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; max-width: 800px; margin: 20px auto; padding: 0 10px; }
        .question-box { background: #f4f4f4; padding: 15px; border-radius: 5px; margin: 10px 0; font-weight: bold; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        .option-btn { display: block; width: 100%; text-align: left; }
        #explanation-container { background: #e7f3fe; padding: 15px; border-left: 5px solid #2196F3; margin-top: 20px; }
        .correct { color: #2ecc71; font-weight: bold; }
        .incorrect { color: #e74c3c; font-weight: bold; }
        #term-reference { margin-top: 15px; font-size: 0.9em; border-top: 1px solid #ccc; padding-top: 10px; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1>ITパスポート 演習</h1>
        <p>カテゴリーを選択してください：</p>
        <button onclick="startQuiz('テクノロジ')">テクノロジ</button>
        <button onclick="startQuiz('マネジメント')">マネジメント</button>
        <button onclick="startQuiz('ストラテジ')">ストラテジ</button>
    </div>

    <div id="quiz-screen" style="display:none;">
        <h2 id="category-title"></h2>
        <div id="progress"></div>
        <div id="question-text" class="question-box"></div>
        <div id="options-container"></div>
        
        <div id="explanation-container" style="display:none;">
            <div id="result-stat"></div>
            <p id="explanation-text"></p>
            <div id="term-reference"></div>
            <button onclick="nextQuestion()">次の問題へ</button>
        </div>
    </div>

    <script>
        let allQuestions = [];
        let allTerms = {};
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;

        // データの読み込み
        window.onload = async () => {
            try {
                const [qRes, tRes] = await Promise.all([
                    fetch('questions.json'),
                    fetch('terms.json')
                ]);
                allQuestions = await qRes.json();
                allTerms = await tRes.json();
            } catch (e) {
                alert("データの読み込みに失敗しました。JSONの構文（カンマ等）を確認してください。");
            }
        };

        // クイズ開始
        function startQuiz(category) {
            currentQuestions = allQuestions.filter(q => q.category === category);
            if (currentQuestions.length === 0) return;

            currentIndex = 0;
            score = 0;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            showQuestion();
        }

        // 問題表示
        function showQuestion() {
            const q = currentQuestions[currentIndex];
            document.getElementById('category-title').innerText = q.category;
            document.getElementById('progress').innerText = `問題 ${currentIndex + 1} / ${currentQuestions.length}`;
            document.getElementById('question-text').innerText = q.question;
            
            const container = document.getElementById('options-container');
            container.innerHTML = "";
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i);
                container.appendChild(btn);
            });
            
            document.getElementById('explanation-container').style.display = 'none';
        }

        // 回答判定
        function checkAnswer(idx) {
            const q = currentQuestions[currentIndex];
            const isCorrect = (idx === q.answer);
            if (isCorrect) score++;

            const resultStat = document.getElementById('result-stat');
            resultStat.innerText = isCorrect ? "【正解】" : `【不正解】正解：${q.options[q.answer]}`;
            resultStat.className = isCorrect ? "correct" : "incorrect";
            
            document.getElementById('explanation-text').innerText = q.explanation;
            
            // 用語解説の紐付け表示
            const termRef = document.getElementById('term-reference');
            termRef.innerHTML = "<strong>関連用語解説:</strong>";
            q.term_ids.forEach(tid => {
                if (allTerms[tid]) {
                    termRef.innerHTML += `<p><strong>${allTerms[tid].name}:</strong> ${allTerms[tid].def}</p>`;
                }
            });

            document.getElementById('explanation-container').style.display = 'block';
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        }

        // 次へ
        function nextQuestion() {
            currentIndex++;
            if (currentIndex < currentQuestions.length) {
                showQuestion();
            } else {
                alert(`終了！ スコア: ${score} / ${currentQuestions.length}`);
                location.reload(); // 最初に戻る
            }
        }
    </script>
</body>
</html>
