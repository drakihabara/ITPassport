<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ITパスポート 習得支援アプリ</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-main: #1a1a1b;
            --border: #e0e0e0;
            --correct: #2e7d32;
            --incorrect: #d32f2f;
            --secondary: #607d8b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f7;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
        }

        /* 問題エリア */
        .section-card {
            background: white;
            border: 1px solid var(--border);
            padding: 24px;
            border-radius: 4px;
        }

        .meta { font-size: 0.8rem; color: var(--secondary); margin-bottom: 8px; font-weight: bold; }
        .question-text { font-size: 1.15rem; font-weight: 500; margin-bottom: 24px; line-height: 1.6; }

        .options { display: flex; flex-direction: column; gap: 12px; }
        .opt-btn {
            text-align: left;
            padding: 16px;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 2px;
            transition: background 0.2s;
        }
        .opt-btn:hover { background: #f8f9fa; }
        
        /* 「まだ」ボタン */
        .not-yet-btn {
            margin-top: 20px;
            width: 100%;
            padding: 12px;
            background: #eeeeee;
            border: 1px solid var(--border);
            cursor: pointer;
            font-weight: bold;
            color: var(--secondary);
        }

        /* 習得済みリスト（大型化） */
        .learned-section {
            background: white;
            border: 1px solid var(--border);
            padding: 24px;
            min-height: 400px;
        }
        .learned-title { font-size: 1.2rem; border-bottom: 2px solid var(--text-main); padding-bottom: 8px; margin-bottom: 16px; }
        .learned-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .keyword-chip {
            background: #f1f3f4;
            border: 1px solid var(--border);
            padding: 6px 12px;
            font-size: 0.9rem;
            color: var(--text-main);
        }

        /* 解説エリア */
        #feedback {
            display: none;
            margin-top: 20px;
            padding: 16px;
            border: 1px solid var(--border);
        }

        /* 右下のデータリセットボタン (スマホUI考慮) */
        .reset-container {
            position: fixed;
            right: 20px;
            bottom: 40px; /* スマホのバーを避けるため少し上げる */
        }
        .reset-btn {
            background: none;
            border: 1px solid var(--border);
            color: #999;
            font-size: 0.75rem;
            padding: 8px 12px;
            cursor: pointer;
        }

        .action-btn {
            margin-top: 16px;
            padding: 12px 24px;
            background: var(--text-main);
            color: white;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="section-card">
        <div class="meta">
            <span id="category">CATEGORY</span> | <span id="q-id">ID</span>
        </div>
        <div id="q-text" class="question-text">読み込み中...</div>
        <div id="options" class="options"></div>
        <button class="not-yet-btn" onclick="handleNotYet()">まだ（理解不足としてリセット）</button>

        <div id="feedback">
            <div id="result-msg" style="font-weight: bold; margin-bottom: 8px;"></div>
            <div id="explanation" style="font-size: 0.95rem; color: #444;"></div>
            <button class="action-btn" onclick="nextQuestion()">次の問題へ</button>
        </div>
    </div>

    <div class="learned-section">
        <div class="learned-title">習得済み用語リスト (<span id="count">0</span>)</div>
        <div id="keyword-list" class="learned-grid"></div>
    </div>
</div>

<div class="reset-container">
    <button class="reset-btn" onclick="resetAllData()">データをリセット</button>
</div>

<script>
// 正規化されたサンプルデータ
const appData = {
    questions: [
        { id: "MG-001", category: "マネジメント", question: "サービス提供時間帯のうち, 実際に利用できた時間の割合を示す指標は？", options: ["可用性", "機能性", "効率性", "使用性"], answer: 0, explanation: "可用性はSLAでも重要な指標であり、システムの継続稼働能力を示します。", term_ids: ["t1", "t2"] },
        { id: "ST-004", category: "ストラテジ", question: "経営資源を「価値・希少性・模倣困難性・組織」で分析する手法は？", options: ["SWOT", "PPM", "3C", "VRIO"], answer: 3, explanation: "VRIO分析は内部資源の競争優位を評価するフレームワークです。", term_ids: ["t3"] },
        { id: "TC-006", category: "テクノロジ", question: "一連の処理が全て成功するか失敗するかのどちらかになる性質は？", options: ["一貫性", "原子性", "耐久性", "独立性"], answer: 1, explanation: "トランザクションの原子性(Atomicity)は、中途半端な状態を許さない性質です。", term_ids: ["t4"] }
    ],
    terms: {
        "t1": { name: "可用性" }, "t2": { name: "SLA" },
        "t3": { name: "VRIO分析" }, "t4": { name: "原子性" }
    }
};

let masteredIds = new Set(JSON.parse(localStorage.getItem('mastered')) || []);
let currentIndex = 0;

function render() {
    const q = appData.questions[currentIndex];
    document.getElementById('category').innerText = q.category;
    document.getElementById('q-id').innerText = q.id;
    document.getElementById('q-text').innerText = q.question;
    document.getElementById('feedback').style.display = 'none';
    
    const container = document.getElementById('options');
    container.innerHTML = '';
    q.options.forEach((opt, i) => {
        const btn = document.createElement('button');
        btn.className = 'opt-btn';
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(i);
        container.appendChild(btn);
    });
    updateListUI();
}

function checkAnswer(idx) {
    const q = appData.questions[currentIndex];
    const isCorrect = (idx === q.answer);
    showFeedback(isCorrect, q);
    
    if (isCorrect) {
        q.term_ids.forEach(id => masteredIds.add(id));
    } else {
        // 不正解時の連帯責任リセット
        q.term_ids.forEach(id => masteredIds.delete(id));
    }
    saveAndRefresh();
}

function handleNotYet() {
    const q = appData.questions[currentIndex];
    // 「まだ」を押した場合は関連用語をすべてリセット
    q.term_ids.forEach(id => masteredIds.delete(id));
    showFeedback(false, q, "理解度リセット済み");
    saveAndRefresh();
}

function showFeedback(correct, q, altMsg) {
    const fb = document.getElementById('feedback');
    const msg = document.getElementById('result-msg');
    fb.style.display = 'block';
    msg.innerText = altMsg || (correct ? "正解" : "不正解");
    msg.style.color = correct ? "var(--correct)" : "var(--incorrect)";
    document.getElementById('explanation').innerText = q.explanation;
    document.querySelectorAll('.opt-btn').forEach(b => b.disabled = true);
}

function updateListUI() {
    const list = document.getElementById('keyword-list');
    list.innerHTML = '';
    masteredIds.forEach(id => {
        const span = document.createElement('span');
        span.className = 'keyword-chip';
        span.innerText = appData.terms[id].name;
        list.appendChild(span);
    });
    document.getElementById('count').innerText = masteredIds.size;
}

function saveAndRefresh() {
    localStorage.setItem('mastered', JSON.stringify([...masteredIds]));
    updateListUI();
}

function nextQuestion() {
    currentIndex = (currentIndex + 1) % appData.questions.length;
    render();
}

function resetAllData() {
    if(confirm('全ての学習データを削除しますか？')) {
        masteredIds.clear();
        saveAndRefresh();
        location.reload();
    }
}

render();
</script>
</body>
</html>
