<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ITパスポート演習</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; max-width: 800px; margin: 20px auto; padding: 0 10px; }
        .question-box { background: #f9f9f9; padding: 15px; border: 1px solid #ddd; border-radius: 5px; margin: 10px 0; }
        .option-btn { display: block; width: 100%; text-align: left; margin: 5px 0; padding: 10px; cursor: pointer; }
        #explanation-container { background: #eef; padding: 15px; border-left: 5px solid #33f; margin-top: 20px; }
        .correct { color: #27ae60; font-weight: bold; }
        .incorrect { color: #c0392b; font-weight: bold; }
        button:disabled { cursor: default; opacity: 0.7; }
        .term-item { margin-top: 10px; font-size: 0.9em; padding: 5px; background: #fff; border: 1px solid #ccc; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1>ITパスポート 演習</h1>
        <p>カテゴリーを選択してください：</p>
        <button onclick="startQuiz('テクノロジ')">テクノロジ</button>
        <button onclick="startQuiz('マネジメント')">マネジメント</button>
        <button onclick="startQuiz('ストラテジ')">ストラテジ</button>
    </div>

    <div id="quiz-screen" style="display:none;">
        <h2 id="current-category"></h2>
        <p id="current-num"></p>
        <div id="question-text" class="question-box"></div>
        <div id="options-container"></div>
        
        <div id="explanation-container" style="display:none;">
            <div id="result-msg"></div>
            <p id="explanation-text"></p>
            <div id="term-list"></div>
            <button onclick="toNext()">次の問題へ</button>
        </div>
    </div>

    <script>
        let allQuestions = [];
        let allTerms = {};
        let quizList = [];
        let cursor = 0;
        let correctCount = 0;

        // 起動時にJSONを読み込む
        window.onload = async () => {
            try {
                const [qRes, tRes] = await Promise.all([
                    fetch('questions.json'),
                    fetch('terms.json')
                ]);
                allQuestions = await qRes.json();
                allTerms = await tRes.json();
            } catch (e) {
                console.error("データ読み込み失敗。JSONの形式を確認してください。");
            }
        };

        // 指定カテゴリーで開始（全分野ボタンは削除）
        function startQuiz(cat) {
            quizList = allQuestions.filter(q => q.category === cat);
            if (quizList.length === 0) return;

            cursor = 0;
            correctCount = 0;
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            render();
        }

        // 問題を表示
        function render() {
            const q = quizList[cursor];
            document.getElementById('current-category').innerText = q.category;
            document.getElementById('current-num').innerText = `問題 ${cursor + 1} / ${quizList.length}`;
            document.getElementById('question-text').innerText = q.question;
            
            const optCont = document.getElementById('options-container');
            optCont.innerHTML = "";
            q.options.forEach((opt, i) => {
                const b = document.createElement('button');
                b.className = "option-btn";
                b.innerText = opt;
                b.onclick = () => answer(i);
                optCont.appendChild(b);
            });
            
            document.getElementById('explanation-container').style.display = 'none';
        }

        // 正誤判定
        function answer(idx) {
            const q = quizList[cursor];
            const isCorrect = (idx === q.answer);
            if (isCorrect) correctCount++;

            const resMsg = document.getElementById('result-msg');
            resMsg.innerText = isCorrect ? "【正解】" : `【不正解】正解：${q.options[q.answer]}`;
            resMsg.className = isCorrect ? "correct" : "incorrect";
            
            document.getElementById('explanation-text').innerText = q.explanation;
            
            // 用語解説
            const tList = document.getElementById('term-list');
            tList.innerHTML = "<strong>用語解説:</strong>";
            q.term_ids.forEach(tid => {
                const t = allTerms[tid];
                if (t) {
                    const d = document.createElement('div');
                    d.className = "term-item";
                    d.innerHTML = `<strong>${t.name}</strong>: ${t.def}`;
                    tList.appendChild(d);
                }
            });

            document.getElementById('explanation-container').style.display = 'block';
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        }

        // 次の問題へ
        function toNext() {
            cursor++;
            if (cursor < quizList.length) {
                render();
            } else {
                alert(`終了！正解数: ${correctCount} / ${quizList.length}`);
                location.reload();
            }
        }
    </script>
</body>
</html>
