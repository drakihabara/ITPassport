<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆè©¦é¨“å¯¾ç­–</title> <style>
    /* ã‚¹ã‚¿ã‚¤ãƒ«ã¯å¤‰æ›´ãªã— */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0.5rem;
      background: #f9f9f9;
      color: #333;
      font-size: 18px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 0.5rem 0 1rem;
    }
    .tag-btn, #nextBtn {
      display: block;
      width: 100%;
      padding: 1rem;
      margin: 0.4rem 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1.1rem;
      background: #fff;
      text-align: center;
      cursor: pointer;
    }
    .tag-btn:hover {
      background: #f0f0f0;
    }
    #question {
      margin: 0.8rem 0;
      font-size: 1.2rem;
      line-height: 1.6;
    }
    #options {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #options li {
      margin-bottom: 0.5rem;
    }
    #options button {
      width: 100%;
      padding: 1rem;
      font-size: 1.1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: #fff;
      text-align: left;
      cursor: pointer;
    }
    #options button:disabled {
      opacity: 0.7;
      cursor: default;
    }
    #progress {
      font-size: 0.9rem;
      text-align: center;
      margin: 0.8rem 0;
    }
    #result h2 {
      text-align: center;
      margin-top: 1.5rem;
    }

    /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒã‚¹ã‚¯ï¼‰ */
    #overlay {
      position: fixed; /* ç”»é¢ã«å›ºå®š */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5); /* åŠé€æ˜ã®é»’ */
      display: none; /* é€šå¸¸ã¯éè¡¨ç¤º */
      z-index: 10;
      /* ç¸¦æ¨ªä¸­å¤®æƒãˆ */
      align-items: center;
      justify-content: center;
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—æœ¬ä½“ï¼‰ */
    #modal {
      background: #fff;
      padding: 1.5rem;
      border-radius: 8px;
      width: 85%; /* ã‚¹ãƒãƒ›ç”»é¢ã®85% */
      max-width: 400px; /* PCã§ã‚‚åºƒãŒã‚Šã™ããªã„ã‚ˆã†ã« */
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    #modal-explanation {
      font-size: 0.95rem;
      color: #333;
      margin-top: 1rem;
      border-top: 1px solid #eee;
      padding-top: 1rem;
    }
    /* ãƒ¢ãƒ¼ãƒ€ãƒ«å†…ã®ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ */
    #modalNextBtn {
      display: block;
      width: 100%;
      padding: 1rem;
      margin-top: 1.5rem;
      border: none;
      border-radius: 6px;
      font-size: 1.1rem;
      background: #0078d7;
      color: #fff;
      cursor: pointer;
    }
    #modalNextBtn:hover {
      background: #005a9e;
    }
</style>
</head>
<body>

  <h1 id="mainTitle">ITãƒ‘ã‚¹ãƒãƒ¼ãƒˆè©¦é¨“å¯¾ç­–</h1> <div id="controls">
      <button class="tag-btn" data-tag="strategy">ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»</button>
      <button class="tag-btn" data-tag="management">ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»</button>
      <button class="tag-btn" data-tag="technology">ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»</button>
  </div>

  <div id="quiz" style="display:none;">
    <div id="question"></div>
    <ul id="options"></ul>
    <div id="progress"></div>
  </div>

  <div id="result" style="display:none;"></div>


  <div id="overlay">
    <div id="modal">
      <div id="modal-message"></div>
      <div id="modal-explanation"></div>
      <button id="modalNextBtn">æ¬¡ã¸ â–¶</button>
    </div>
  </div>

<script>
  /* JavaScriptéƒ¨åˆ†ã¯å¤‰æ›´ãªã—ï¼ˆå¾Œã§csvFileNameé–¢æ•°ã¯ä¿®æ­£ãŒå¿…è¦ã§ã™ï¼‰ */
  let questions=[],current=0,score=0;

  // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
  document.addEventListener('DOMContentLoaded', () => {

    document.querySelectorAll('.tag-btn').forEach(btn=>{
      // ã‚¯ãƒªãƒƒã‚¯ã§startQuizã‚’å‘¼ã³å‡ºã™
      btn.onclick=()=>startQuiz(btn.dataset.tag);
    });

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã®å‡¦ç†
    document.getElementById('modalNextBtn').onclick = () => {
      document.getElementById('overlay').style.display = 'none'; // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹

      // æ¬¡ã®å•é¡Œã¸é€²ã‚€
      if (++current < questions.length) {
        showQuestion();
      } else {
        showResults();
      }
    };
  });


  /* CSVãƒ‘ãƒ¼ã‚µãƒ¼ (å¤‰æ›´ãªã—) */
  async function loadCSV(file){
    const text = await (await fetch(file)).text();
    const parseCsvLine = (line) => {
      const result = [];
      let currentField = '';
      let inQuote = false;
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
          if (inQuote && line[i + 1] === '"') {
            currentField += '"';
            i++;
          } else {
            inQuote = !inQuote;
          }
        } else if (char === ',' && !inQuote) {
          result.push(currentField);
          currentField = '';
        } else {
          currentField += char;
        }
      }
      result.push(currentField);
      return result.map(field => {
        if (field.startsWith('"') && field.endsWith('"')) {
          return field.substring(1, field.length - 1).replace(/""/g, '"');
        }
        return field;
      });
    };
    return text.trim().split(/\r?\n/).slice(1).map(line => {
      if (!line) return null;
      const c = parseCsvLine(line);
      if (c.length < 5) return null;
      const lastIdx = c.length - 1;
      const answerIdx = lastIdx - 1;
      return {
        q: c[1],
        options: c.slice(2, answerIdx),
        answer: +c[answerIdx] - 1,
        explanation: c[lastIdx]
      };
    }).filter(q => q !== null);
  }

  /* shuffle (å¤‰æ›´ãªã—) */
  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
  }

  /* csvFileName (â˜…å¾Œã§ä¿®æ­£ãŒå¿…è¦ã§ã™â˜…) */
  function csvFileName(tag){
    // â–¼â–¼â–¼ ã“ã“ã‚’ä¿®æ­£ã—ã¦ã€strategy.csvãªã©ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã™ â–¼â–¼â–¼
    return {
      strategy: 'strategy.csv',    // ä¾‹: ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ç³»ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ã
      management: 'management.csv', // ä¾‹: ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆç³»ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ã
      technology: 'technology.csv' // ä¾‹: ãƒ†ã‚¯ãƒãƒ­ã‚¸ç³»ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã¨ã
    }[tag];
  }

  /* startQuiz (å…¨å•å‡ºé¡Œã™ã‚‹ã‚ˆã†ã«ä¿®æ­£æ¸ˆã¿ - å¤‰æ›´ãªã—) */
  async function startQuiz(tag){
    document.getElementById('controls').style.display='none';
    document.getElementById('mainTitle').style.display='none';

    let pool;
    const fileName = csvFileName(tag); // â† ä¿®æ­£å¾Œã®é–¢æ•°ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
    if (!fileName) {
        alert("å¯¾å¿œã™ã‚‹CSVãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
        document.getElementById('controls').style.display='';
        document.getElementById('mainTitle').style.display='block';
        return;
    }

    try {
      pool = await loadCSV(fileName); // â† æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’èª­ã¿è¾¼ã‚€
    } catch(err) {
      console.error("CSV Load Error:", err);
      pool = [];
    }

    if (!pool || pool.length === 0) {
        alert(`å•é¡Œãƒ•ã‚¡ã‚¤ãƒ«(${fileName})ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
        document.getElementById('controls').style.display='';
        document.getElementById('mainTitle').style.display='block';
        return;
    }

    questions=shuffle(pool).slice(0,pool.length);
    current=score=0;
    document.getElementById('result').style.display='none';
    document.getElementById('quiz').style.display='';
    showQuestion();
  }

  /* showQuestion (innerHTML ã‚’ä½¿ç”¨ - å¤‰æ›´ãªã—) */
  function showQuestion(){
    const q=questions[current];
    document.getElementById('question').innerHTML = q.q;
    const ul=document.getElementById('options'); ul.innerHTML='';
    q.options.forEach((opt,i)=>{
      const li=document.createElement('li');
      li.innerHTML=`<button>${opt}</button>`;
      li.firstChild.onclick=()=>selectAnswer(i);
      ul.appendChild(li);
    });
    document.getElementById('progress').textContent=`${current+1}/${questions.length}`;
  }


  /* selectAnswer (innerHTML ã‚’ä½¿ç”¨ - å¤‰æ›´ãªã—) */
  function selectAnswer(idx){
    const q=questions[current],ul=document.getElementById('options');

    // é¸æŠè‚¢ã®ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ï¼†è‰²ä»˜ã‘
    [...ul.children].forEach((li,i)=>{
      const b=li.firstChild; b.disabled=true;
      if(i===q.answer)b.style.background='lightgreen';
      else if(i===idx)b.style.background='salmon';
    });

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ä¸­èº«ã‚’ä½œæˆ
    let msgHtml = '';
    if (idx === q.answer) {
      score++;
      msgHtml = '<span style="color:green; font-weight: bold;">ğŸŸ¢ æ­£è§£ï¼</span>';
    } else {
      msgHtml = `<span style="color:red; font-weight: bold;">âŒ ä¸æ­£è§£</span>
                  <br><span style="color:#555">æ­£è§£: ${q.options[q.answer]}</span>`;
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¦ç´ ã‚’å–å¾—ã—ã¦ä¸­èº«ã‚’ã‚»ãƒƒãƒˆ
    document.getElementById('modal-message').innerHTML = msgHtml;
    document.getElementById('modal-explanation').innerHTML = "<b>è§£èª¬:</b> " + q.explanation;

    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ï¼‰ã‚’è¡¨ç¤º
    document.getElementById('overlay').style.display = 'flex';
  }


  /* showResults (å¤‰æ›´ãªã—) */
  function showResults(){
    document.getElementById('quiz').style.display='none';
    const r=document.getElementById('result');
    r.innerHTML=`<h2>çµæœ: ${score}/${questions.length}</h2>`;
    r.style.display='';
    document.getElementById('controls').style.display='';
    document.getElementById('mainTitle').style.display='block';
  }
</script>
</body>
</html>
