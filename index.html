<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ITパスポート クイズ</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #fff; color: #000; }
    .question { font-size: 18px; margin-bottom: 16px; }
    .option { display: block; width: 100%; margin: 8px 0; padding: 12px; font-size: 16px;
              border: 1px solid #ccc; border-radius: 6px; background: #f9f9f9; text-align: left; }
    .option.correct { background: #d1fae5; border-color: #10b981; }
    .option.wrong { background: #fee2e2; border-color: #ef4444; }
    #feedback { margin-top: 12px; font-weight: bold; }
    #explanation { margin-top: 8px; font-size: 14px; color: #333; }
  </style>
</head>
<body>
  <div id="start">
    <h2>分野を選んでください</h2>
    <button onclick="startQuiz('ストラテジ')">ストラテジ</button>
    <button onclick="startQuiz('マネジメント')">マネジメント</button>
    <button onclick="startQuiz('テクノロジ')">テクノロジ</button>
    <button onclick="startQuiz('all')">全分野</button>
  </div>

  <div id="quiz" style="display:none;">
    <div id="qText" class="question"></div>
    <div id="options"></div>
    <div id="feedback"></div>
    <div id="explanation"></div>
  </div>

  <script>
  let allQuestions = [];
  let questions = [];
  let idx = 0;
  let score = 0;

  async function loadCSV() {
    const res = await fetch('questions.csv');
    const text = await res.text();
    const lines = text.trim().split('\n').slice(1);
    allQuestions = lines.map(line => {
      const cols = line.split(',');
      return {
        q: cols[1],
        options: [cols[2], cols[3], cols[4], cols[5]],
        answer: parseInt(cols[6], 10) - 1,
        explanation: cols[7],
        tag: cols[8]
      };
    });
  }

  function startQuiz(tag) {
    document.getElementById('start').style.display = 'none';
    document.getElementById('quiz').style.display = 'block';

    let pool = (tag === 'all') ? allQuestions : allQuestions.filter(q => q.tag === tag);

    // シャッフルして20問抽出
    pool = shuffle(pool);
    questions = pool.slice(0, 20);

    idx = 0;
    score = 0;
    showQuestion();
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function showQuestion() {
    const q = questions[idx];
    document.getElementById('qText').textContent = `Q${idx+1}. ${q.q}`;
    const optDiv = document.getElementById('options');
    optDiv.innerHTML = '';
    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.textContent = opt;
      btn.className = 'option';
      btn.onclick = () => checkAnswer(i);
      optDiv.appendChild(btn);
    });
    document.getElementById('feedback').textContent = '';
    document.getElementById('explanation').textContent = '';
  }

  function checkAnswer(i) {
    const q = questions[idx];
    const opts = document.querySelectorAll('.option');
    opts.forEach((b, j) => {
      if (j === q.answer) b.classList.add('correct');
      if (j === i && i !== q.answer) b.classList.add('wrong');
      b.disabled = true;
    });

    if (i === q.answer) {
      document.getElementById('feedback').textContent = '✅ 正解！';
      score++;
    } else {
      document.getElementById('feedback').textContent = '❌ 不正解…';
    }
    document.getElementById('explanation').textContent = `解説: ${q.explanation}`;

    setTimeout(() => {
      idx++;
      if (idx < questions.length) {
        showQuestion();
      } else {
        showResult();
      }
    }, 2000);
  }

  function showResult() {
    document.getElementById('quiz').innerHTML = `
      <h2>結果</h2>
      <p>正解数: ${score} / ${questions.length}</p>
      <button onclick="location.reload()">もう一度</button>
    `;
  }

  loadCSV();
  </script>
</body>
</html>
