async function loadCSV(file) {
  const res = await fetch(file);
  const text = (await res.text()).replace(/^\uFEFF/, '');
  const lines = text.split(/\r?\n/).filter(l => l.trim() !== '');
  const rows = parseCSV(lines).slice(1); // ヘッダ除外
  return rows.map(cols => ({
    q: cols[1],
    options: [cols[2], cols[3], cols[4], cols[5]],
    answer: parseInt(cols[6], 10) - 1,
    explanation: cols[7],
    tag: cols[8]
  }));
}

async function startQuiz(tag) {
  let pool = [];
  if (tag === 'ストラテジ') {
    pool = await loadCSV('strategy.csv');
  } else if (tag === 'マネジメント') {
    pool = await loadCSV('management.csv');
  } else if (tag === 'テクノロジ') {
    pool = await loadCSV('technology.csv');
  } else if (tag === 'all') {
    const s = await loadCSV('strategy.csv');
    const m = await loadCSV('management.csv');
    const t = await loadCSV('technology.csv');
    pool = [...s, ...m, ...t];
  }

  pool = shuffle(pool);
  questions = pool.slice(0, Math.min(30, pool.length));
  // 以下 showQuestion() へ
}
