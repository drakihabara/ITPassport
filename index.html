<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>IT„Éë„Çπ„Éù„Éº„Éà</title>
<style>
  body { font-family: sans-serif; margin:1rem; background:#f9f9f9; color:#333; }
  h1 { text-align:center; font-size:1.4rem; margin-bottom:1rem; }
  .tag-btn, #nextBtn {
    display:block; width:100%; padding:0.8rem; margin:0.5rem 0;
    border:1px solid #ccc; border-radius:6px; font-size:1rem; background:#fff;
  }
  #progress { font-size:0.9rem; text-align:right; margin:0.5rem 0; }
  #question { margin:1rem 0; font-size:1rem; line-height:1.4; }
  #options { list-style:none; padding:0; }
  #options li { margin-bottom:0.6rem; }
  #options button { width:100%; padding:0.8rem; border:1px solid #ccc; border-radius:6px; background:#fff; text-align:left; }
  #options button:disabled { opacity:0.7; }
  #result h2 { text-align:center; margin-top:2rem; }
  #nextBtn { background:#0078d7; color:#fff; display:none; }
  #nextBtn:hover { background:#005a9e; }
</style>
</head>
<body>
<h1>IT„Éë„Çπ„Éù„Éº„Éà</h1>

<div id="controls">
  <button class="tag-btn" data-tag="„Çπ„Éà„É©„ÉÜ„Ç∏">„Çπ„Éà„É©„ÉÜ„Ç∏</button>
  <button class="tag-btn" data-tag="„Éû„Éç„Ç∏„É°„É≥„Éà">„Éû„Éç„Ç∏„É°„É≥„Éà</button>
  <button class="tag-btn" data-tag="„ÉÜ„ÇØ„Éé„É≠„Ç∏">„ÉÜ„ÇØ„Éé„É≠„Ç∏</button>
  <button class="tag-btn" data-tag="syllabus63plus">„Ç∑„É©„Éê„Çπ6.3‰ª•ÈôçÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ</button>
</div>

<div id="quiz" style="display:none;">
  <div id="progress"></div>
  <div id="question"></div>
  <ul id="options"></ul>
  <button id="nextBtn">Ê¨°„Å∏ ‚ñ∂</button>
</div>

<div id="result" style="display:none;"></div>

<script>
const NUM_EASY=5,NUM_MID=10,NUM_ADV=5;
let questions=[],current=0,score=0;

document.querySelectorAll('.tag-btn').forEach(btn=>{
  btn.onclick=()=>startQuiz(btn.dataset.tag);
});

async function loadCSV(file){
  const text=await (await fetch(file)).text();
  return text.trim().split("\n").slice(1).map(line=>{
    const c=line.split(",");
    return {q:c[1],options:c.slice(2,6),answer:+c[6]-1,explanation:c[7],difficulty:(c[9]||'').trim()};
  });
}

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function pick(pool,d,n){return shuffle(pool.filter(q=>q.difficulty===d)).slice(0,n);}
function csvFileName(tag){return {„Çπ„Éà„É©„ÉÜ„Ç∏:'strategy.csv',„Éû„Éç„Ç∏„É°„É≥„Éà:'management.csv',„ÉÜ„ÇØ„Éé„É≠„Ç∏:'technology.csv',syllabus63plus:'syllabus63plus.csv'}[tag];}

async function startQuiz(tag){
  document.getElementById('controls').style.display='none';
  const pool=await loadCSV(csvFileName(tag));
  questions=(tag==='syllabus63plus')?shuffle(pool).slice(0,20):shuffle([...pick(pool,'ÂàùÁ¥ö',NUM_EASY),...pick(pool,'Ê®ôÊ∫ñ',NUM_MID),...pick(pool,'ÂøúÁî®',NUM_ADV)]);
  current=score=0;
  document.getElementById('result').style.display='none';
  document.getElementById('quiz').style.display='';
  showQuestion();
}

function showQuestion(){
  const q=questions[current];
  document.getElementById('progress').textContent=`ÂïèÈ°å ${current+1}/${questions.length}`;
  document.getElementById('question').textContent=q.q;
  const ul=document.getElementById('options'); ul.innerHTML='';
  q.options.forEach((opt,i)=>{
    const li=document.createElement('li');
    li.innerHTML=`<button>${opt}</button>`;
    li.firstChild.onclick=()=>selectAnswer(i);
    ul.appendChild(li);
  });
}

function selectAnswer(idx){
  const q=questions[current],ul=document.getElementById('options');
  [...ul.children].forEach((li,i)=>{
    const b=li.firstChild; b.disabled=true;
    if(i===q.answer)b.style.background='lightgreen';
    else if(i===idx)b.style.background='salmon';
  });
  const quiz=document.getElementById('quiz');
  const msg=document.createElement('p');
  msg.innerHTML=(idx===q.answer?(score++,'<span style="color:green">üü¢ Ê≠£Ëß£ÔºÅ</span>'):`<span style="color:red">‚ùå ‰∏çÊ≠£Ëß£</span><br><span style="color:#555">Ê≠£Ëß£: ${q.options[q.answer]}</span>`);
  const exp=document.createElement('p'); exp.textContent="Ëß£Ë™¨: "+q.explanation;
  quiz.append(msg,exp);
  const next=document.getElementById('nextBtn');
  next.style.display='block';
  next.onclick=()=>{
    msg.remove(); exp.remove(); next.style.display='none';
    if(++current<questions.length)showQuestion(); else showResults();
  };
}

function showResults(){
  document.getElementById('quiz').style.display='none';
  const r=document.getElementById('result');
  r.innerHTML=`<h2>ÁµêÊûú: ${score}/${questions.length}</h2>`;
  r.style.display='';
  document.getElementById('controls').style.display='';
}
</script>
</body>
</html>
